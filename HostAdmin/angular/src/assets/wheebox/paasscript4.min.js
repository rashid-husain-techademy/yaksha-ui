function includeJs(jsFilePath) {
    var js = document.createElement("script");
    js.type = "text/javascript";
    js.src = jsFilePath;
    document.body.appendChild(js);
} 
includeJs("https://statiswheebox.z29.web.core.windows.net/stream/node_modules/recordrtc/RecordRTC.js");
	  
	 var recording_frame="20";
	 var recording_time="120000";  
	 var uploadVideoClipCounter=0; 
	 var paasScriptRStop; 
	 var recorder; 
	 var myEvent;
	 var startrecordingboolen=true;
	 var imgftstatus=""; 
	 
	 function paasScriptStart4(event){ 
		   //console.log("Start Video Recording...");  
		   myEvent=event;
	
			recorder = RecordRTC(event.stream, { 
				type: 'video',           
			    //audioBitsPerSecond : recording_frame * 8 * 1024,
			    //videoBitsPerSecond : recording_frame * 8 * 1024,
			    bitsPerSecond: recording_frame * 8 * 1024,  // if this is provided, skip above two  
			});          
		    recorder.startRecording();
		    clearTimeout(paasScriptRStop);
		    paasScriptRStop=setTimeout(function(){  
		    	paasScriptStop4("thread"); 
		    }, recording_time);
		}
	 
	 function paasScriptStop4(value){   
		    //console.log("Stop Video Recording...");  
	        recorder.stopRecording(function() {
	              var blob = recorder.getBlob();
	              
	              	if(startrecordingboolen){
			   
					if(udetail.hasOwnProperty("recordsession")){
						if(udetail.recordsession == 'enabled'){
							getBase64(blob,udetail); 
							//alert("ok");
							uploadVideoClipCounter++;   
						}
							//startrecordingboolen=false;
					}
					 		 
					}else{
						console.log("Video Recording not enabled");  
					}
	              
	             
	           paasScriptStart4(myEvent);  
	        }); 
	    }

function getBase64(blob,userdetail) { 
   var reader = new FileReader();
   reader.readAsDataURL(blob);
   reader.onload = function () {
    // console.log(reader.result);
     //console.log("ok---> ");     
     callrecordingession((reader.result),userdetail); 
   };             
   reader.onerror = function (error) {
     console.log('Error: ', error);
   }; 
}
function callrecordingession(blob,userdetail){
			var userwheeboxID="";
		  // console.log("noface called----> "+(tokenValue));
		try{
			//var ftstatus="";
			//if(!noface)ftstatus="NFF";else if(!mtoff)ftstatus="MTOFF";else if(!facecheck)ftstatus="FNM";else if(!objectcheck)ftstatus="SODF";         
			//alert("imgftstatus: "+imgftstatus);   
			var fname=userdetail.student_name;		 
			 
		 	var aadhaar="";
		 	key_sno=userdetail.attemptId;
			var student_unique_id=userdetail.student_unique_id;
			var event_id="";
			var attemptnumber="";
			var instanceid="";
		 if(document.getElementById("instanceid")){
			instanceid=document.getElementById("instanceid").value;} 
            var appURL="";
            if(document.getElementById("appURL")){appURL=document.getElementById("appURL").value;}
			var dataMap = {"uName": (userwheeboxID)+"",
			              "msg": (blob),      
			              "colorCode": tokenValue,
			              "type": "chat",
			              "url": "/"+instanceid+key_sno+"ws1/",
					      "random": Math.random(),
					      "id": aadhaar,"key_sno": key_sno,
					      "fname": fname,
					      "sendto": userwheeboxID,
					      "proctorID": "",
					      "subtype": "user",
					      "secoundUrl": "/"+instanceid+key_sno+"ws2/",
					      "action": "rectoserver",
					      "student_unique_id":student_unique_id,
					      "event_id":event_id,
					      "recording_frame":recording_frame,
					      "recording_time":recording_time,
					      "uploadVideoClipCounter":uploadVideoClipCounter,
					      "audioFound":"",
					      "faceStatus":imgftstatus,
					      "appURL":appURL,"chaturl":wssURL,"streamurl":connection.socketURL}; 
			        
 
			sendGet1(dataMap);				
			
			 imgftstatus="";   
			return false;   
		}catch(e){ 
		console.log("Error callrecordingession fun: "+e); 	
		}
		 
	}	   