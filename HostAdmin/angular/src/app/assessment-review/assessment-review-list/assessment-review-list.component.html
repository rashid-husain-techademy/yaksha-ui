<div id="assessment-review">
    <div class="d-flex align-items-center justify-content-between m-b-20">
        <h3 class="page-title m-0">{{constants.assessmentsOnReview}}</h3>
    </div>

    <div class="card">
        <div class="card-body">
            <form action="" class="filter d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center justify-content-between m-r-40 category-custom">
                    <i class="fas fa-filter text-info m-r-10"></i>
                    <div class="col-sm-6">
                        <ng-multiselect-dropdown [(ngModel)]="selectedCategory"
                            (onSelect)="getAssessmentByCategoryId($event)" (onDeSelect)="onCategoryDeselect()"
                            [data]="categories" [placeholder]="constants.selectCategory"
                            [settings]="singleDropdownSettings" [ngModelOptions]="{standalone: true}">
                        </ng-multiselect-dropdown>
                    </div>
                    <div class="input-group">
                        <input type="text" placeholder="{{constants.search}}" [(ngModel)]="searchValue"
                            [ngModelOptions]="{standalone: true}" class="form-control"
                            (change)="getAssessmentListForReview()">
                        <button type="button" class="btn btn-info m-l-15" (click)="getAssessmentListForReview()">
                            <i class="fas fa-search"></i>
                        </button>
                        <button class="btn btn-secondary m-l-5" type="button" (click)="reset()">
                            <i class="fas fa-undo"></i>
                        </button>
                    </div>
                </div>
                <div class="d-flex align-items-center justify-content-end">
                    <span class="m-r-10">{{constants.filterBy}}:</span>
                    <div class="btn-group m-r-10">
                        <button type="button" class="btn m-r-0"
                            [ngClass]="!reviewerStatus ? 'btn-info' : 'btn-outline-secondary'"
                            (click)="getAssessmentByReviewStatus()">
                            {{constants.all}}
                        </button>
                        <button type="button" class="btn btn-outline-secondary m-r-0"
                            [ngClass]="reviewerStatus === assessmentReviewStatus.Pending ? 'btn-info' : 'btn-outline-secondary'"
                            (click)="getAssessmentByReviewStatus(assessmentReviewStatus.Pending)">
                            {{constants.pending}}
                        </button>
                        <button type="button" class="btn btn-outline-secondary m-r-0"
                            [ngClass]="reviewerStatus === assessmentReviewStatus.SignedOff ? 'btn-info' : 'btn-outline-secondary'"
                            (click)="getAssessmentByReviewStatus(assessmentReviewStatus.SignedOff)">
                            {{constants.signedOff}}
                        </button>
                        <button type="button" class="btn btn-outline-secondary m-r-0"
                            [ngClass]="reviewerStatus === assessmentReviewStatus.Expired ? 'btn-info' : 'btn-outline-secondary'"
                            (click)="getAssessmentByReviewStatus(assessmentReviewStatus.Expired)">
                            {{constants.expired}}
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="result-count">
        <hr>
        <strong class="result">{{viewCount}} {{constants.of}} {{totalCount}}</strong>
    </div>

    <div class="assessments-list d-flex flex-wrap" *ngIf="assessments?.length > 0">
        <div class="p-10" *ngFor="let assessment of assessments">
            <div class="card m-b-0">
                <div>
                    <div class="ribbon ribbon-top-left"
                        *ngIf="assessment.reviewStatus === assessmentReviewStatus.Pending"
                        [ngClass]="assessment.reviewStatus === assessmentReviewStatus.Pending ? 'drafts' : ''">
                        <span>{{constants.pending}}</span>
                    </div>
                    <div class="ribbon ribbon-top-left"
                        *ngIf="assessment.reviewStatus === assessmentReviewStatus.ReviewSubmitted"
                        [ngClass]="assessment.reviewStatus === assessmentReviewStatus.ReviewSubmitted ? 'published' : ''">
                        <span>{{constants.submitted}}</span>
                    </div>
                    <div class="ribbon ribbon-top-left"
                        *ngIf="assessment.reviewStatus === assessmentReviewStatus.SignedOff"
                        [ngClass]="assessment.reviewStatus === assessmentReviewStatus.SignedOff ? 'scheduled' : ''">
                        <span>{{constants.signedOff}}</span>
                    </div>
                    <div class="ribbon ribbon-top-left"
                        *ngIf="assessment.reviewStatus === assessmentReviewStatus.Expired"
                        [ngClass]="assessment.reviewStatus === assessmentReviewStatus.Expired ? 'expired' : ''">
                        <span>{{constants.expired}}</span>
                    </div>
                </div>
                <button class="btn actions">
                    <i class="mdi mdi-view-dashboard" style="margin-right:10px;"
                        (click)="redirectToDashboard(assessment.tenantAssessmentReviewId , assessment.assessmentId)"></i>
                    <i *ngIf="(userRole.toLowerCase() === assessment.createdUserRoleName.toLowerCase() || userRole === userRoles[7]) && userRole !== userRoles[6] && (assessment.reviewStatus === assessmentReviewStatus.Pending || assessment.reviewStatus === assessmentReviewStatus.Expired)"
                        class="ti-trash text-danger" (click)="deleteAssessment(assessment)"></i>
                    <i *ngIf="(userRole.toLowerCase() === assessment.createdUserRoleName.toLowerCase() || userRole === userRoles[7]) && userRole !== userRoles[6] && assessment.reviewStatus === assessmentReviewStatus.Expired"
                        (click)="onUpdate(assessment)" class="ti-pencil text-info"></i>
                </button>
                <div class="card-body d-flex flex-column m-t-10" fxFlex="20">
                    <!-- <div matBadge="G" matBadgeOverlap="false" class="demo-section badge-css"></div> -->
                    <h4 (click)="onAssessmentClick(assessment)" [ngbTooltip]="assessment?.assessmentName"
                        placement="top" class="z-index height assessment-label">
                        {{assessment.assessmentName}}
                    </h4>
                    <h6 *ngIf="userRole !== userRoles[6]">
                        {{assessment?.reviewStatus ===
                        assessmentReviewStatus.ReviewSubmitted ? assessment?.submittedBy : assessment?.reviewStatus ===
                        assessmentReviewStatus.SignedOff ? assessment?.signedoffBy : '-'
                        }}
                    </h6>
                    <h6 *ngIf="userRole === userRoles[6]">{{assessment.createdBy}}</h6>
                    <div class="d-flex align-items-center">
                        <div class="m-r-20" *ngIf="assessment?.requestedOn">
                            <div class="text-info m-0">{{assessment.requestedOn | date:'d MMM y' }}</div>
                            <small class="text-muted">{{constants.requestedOn}}</small>
                        </div>
                        <div class="m-r-20" *ngIf="assessment?.expiryDate">
                            <div class="text-info m-0">{{assessment.expiryDate | date:'d MMM y'}}</div>
                            <small class="text-muted">{{constants.expiresOn}}</small>
                        </div>
                        <div *ngIf="assessment?.signedOffOn">
                            <div class="text-info m-0">{{assessment.signedOffOn | date:'d MMM y'}}</div>
                            <small class="text-muted">{{constants.signedOffon}}</small>
                        </div>
                    </div>

                    <div class="d-flex align-items-center">
                        <div class="m-r-20">
                            <div class="text-info m-0">{{assessment.reviewedQuestionsDetails.accepted}}</div>
                            <a class="text-muted pointer"
                                (click)="navigateToReviewQuestionnaire(constants.accepted, assessment.tenantAssessmentReviewId, assessment.tenantId, assessment.reviewedQuestionsDetails.accepted)">{{constants.accepted}}</a>
                        </div>
                        <div class="m-r-20">
                            <div class="text-info m-0">{{assessment.reviewedQuestionsDetails.rejected}}</div>
                            <a class="text-muted pointer"
                                (click)="navigateToReviewQuestionnaire(constants.rejected, assessment.tenantAssessmentReviewId, assessment.tenantId, assessment.reviewedQuestionsDetails.rejected)">{{constants.rejected}}</a>
                        </div>
                        <div>
                            <div class="text-info m-0">{{assessment.reviewedQuestionsDetails.suggested}}</div>
                            <a class="text-muted pointer"
                                (click)="navigateToReviewQuestionnaire(constants.suggested, assessment.tenantAssessmentReviewId, assessment.tenantId, assessment.reviewedQuestionsDetails.suggested)">{{constants.suggested}}</a>
                        </div>
                        <div class="m-l-15">
                            <div class="text-info m-0">{{assessment.reviewedQuestionsDetails.pending}}</div>
                            <a class="text-muted pointer"
                                (click)="navigateToReviewQuestionnaire(constants.pending, assessment.tenantAssessmentReviewId, assessment.tenantId, assessment.reviewedQuestionsDetails.pending)">{{constants.pending}}</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div *ngIf="assessments?.length === 0" class="text-align-center">
        {{constants.noDataFound}}
    </div>
</div>

<div class="d-flex justify-content-center">
    <ngb-pagination [collectionSize]="totalCount" [pageSize]="pageSize" [(page)]="pageIndex"
        class="d-flex justify-content-center" (pageChange)="changePage()" [maxSize]="maxSize" [rotate]="true"
        [ellipses]="false" [boundaryLinks]="true">
    </ngb-pagination>
</div>