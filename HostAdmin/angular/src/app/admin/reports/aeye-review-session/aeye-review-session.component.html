<div class="review-session-page">
    <div class="col-md-12">
        <div class="d-flex flex-wrap justify-content-between">
            <div class="d-flex align-items-center">
                <i class="fa fa-arrow-left m-r-10 " (click)="profileReport()"></i>
                <h1>{{userDetails?.first_name}} {{userDetails?.last_name}}</h1>
            </div>
            <div>
                <button type="button" class="btn btn-info" (click)="getFullVideo()"><i
                        class="fa fa-play m-r-10"></i>{{constants.getFullVideo}}</button>
                <button type="button" class="btn btn-outline-secondary"
                    *ngIf="userDetails?.proctoring_result !== constants.approve.toLowerCase() && userDetails?.proctoring_result !== constants.reject.toLowerCase()"
                    (click)="openRejectReasonModal(proctoringStatus.Approved)"><i
                        class="fa fa-check m-r-10"></i>{{constants.approve}}</button>
                <button type="button" class="btn btn-outline-secondary"
                    *ngIf="userDetails?.proctoring_result !== constants.approve.toLowerCase() && userDetails?.proctoring_result !== constants.reject.toLowerCase()"
                    (click)="openRejectReasonModal(proctoringStatus.Rejected)"><i
                        class="fa fa-times m-r-10"></i>{{constants.reject}}</button>
                <button type="button" class="btn btn-rounded btn-outline-info"
                    *ngIf="userDetails?.proctoring_result === constants.approve.toLowerCase() || userDetails?.proctoring_result === constants.reject.toLowerCase()">
                    <span>Proctoring Status:</span> {{userDetails?.proctoring_result}}</button>

            </div>
        </div>
        <div class="d-flex  flex-wrap justify-content-between">
            <div class="video-player d-flex flex-column w-66">
                <div class="card">
                    <div class="card-body d-flex col-12">
                        <div class="col-6">
                            <video *ngIf="reportClipDetails?.cam_live?.includes('https')"
                                [src]="reportClipDetails?.cam_live" controls></video><span class="fw-b"
                                *ngIf="!reportClipDetails?.cam_live?.includes('https') || !reportClipDetails?.cam_live">{{constants.candidateVideoNotApplicable}}</span>
                        </div>
                        <div class="col-6">
                            <video *ngIf="reportClipDetails?.desktop_recording?.includes('https')"
                                [src]="reportClipDetails?.desktop_recording" controls></video><span class="fw-b"
                                *ngIf="!reportClipDetails?.desktop_recording?.includes('https') || !reportClipDetails?.desktop_recording">{{constants.desktopVideoNotApplicable}}</span>
                        </div>
                    </div>
                </div>
                <div class="profile-details">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex flex-wrap justify-content-between align-items-stretch  h-100">
                                <div class="d-flex flex-wrap justify-content-between w-44">
                                    <div>
                                        <div class="mb-15">
                                            <h6>{{constants.firstName}}</h6>
                                            <small>{{userDetails?.first_name}}</small>
                                        </div>
                                        <div class="mb-15">
                                            <h6>{{constants.lastName}}</h6>
                                            <small>{{userDetails?.last_name}}</small>
                                        </div>
                                        <div class="mb-15">
                                            <h6>{{constants.email}}</h6>
                                            <small>{{userDetails?.email_id}}</small>
                                        </div>
                                    </div>
                                    <div>
                                        <div>
                                            <h6>{{constants.photo}}</h6>
                                            <img [src]="userDetails?.mug_shots_front_image_blob_name">
                                        </div>
                                        <div class="mt-4" *ngIf="userDetails?.person_with_id_card_image_blob_name">
                                            <h6>{{constants.idCard}}</h6>
                                            <img [src]="userDetails?.person_with_id_card_image_blob_name">
                                        </div>
                                    </div>
                                </div>
                                <!-- Messages-section -->
                                <div class="w-54">
                                    <div class="messages-container">
                                        <h6>{{constants.messages}}</h6>
                                        <div class="message-section d-flex flex-column" *ngIf="chatHistory?.length > 0">
                                            <ng-container *ngFor="let chat of chatHistory">
                                                <div class="d-flex flex-column"
                                                    [ngClass]="chat.created_for === 'proctor' ? 'admin-msg-container' : 'user-msg-container align-self-end'">
                                                    <p>{{chat.message_text}}</p>
                                                    <small class="align-self-end">{{chat.created_at | date:
                                                        'shortTime'}}</small>
                                                </div>
                                                <br>
                                            </ng-container>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- expandable menu -->
            <div class="w-24" class="accordion-section">
                <div class="card">
                    <div class="card-body" *ngIf="sessionAlerts?.length">
                        <mat-accordion *ngFor="let alert of sessionAlerts">
                            <mat-expansion-panel>
                                <mat-expansion-panel-header>
                                    <mat-panel-title>
                                        <div class="d-flex align-items-center">
                                            <i class="fa fa-mobile"></i>
                                            <div class="d-flex flex-column">
                                                <span>{{alert.alert_title}}</span>
                                                <small>{{alert.timestamp | date: 'shortTime'}}</small>
                                            </div>
                                        </div>
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <img *ngIf="alert?.media_blob_name" [src]="alert.media_blob_name"
                                    (click)="loadVideo(alert)">
                                <span class="f-size"
                                    *ngIf="!alert?.media_blob_name">{{constants.videoNotApplicable}}</span>
                            </mat-expansion-panel>
                        </mat-accordion>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template #rejectReasonModal let-modal>
    <div class="modal-header">
        <h4 class="modal-title">{{modalTitle}}</h4>
        <button type="button" class="close" aria-label="Close" (click)="closeModal()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <p>{{modalMessage}}</p>
        <div class="m-t-5 m-b-5">
            <input type="text" class="form-control" [placeholder]="modalPlaceholder" [(ngModel)]="rejectReason"
                maxlength="350">
        </div>
        <div class="m-t-20 text-align-right">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">
                {{constants.cancel}}</button>
            <button type="button" class="btn btn-info" (click)="updateProctorStatus()"><i
                    class="m-r-10"></i>{{modalTitle}}</button>
        </div>
    </div>
</ng-template>